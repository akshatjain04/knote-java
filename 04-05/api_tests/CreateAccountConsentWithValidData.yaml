# ********RoostGPT********

# Test generated by RoostGPT for test MiniProjects using AI Type Open AI and AI Model gpt-4-1106-preview
# 
# ROOST_METHOD_HASH=5a466edee9
# ROOST_METHOD_SIG_HASH=3ada4717c4
# 
#    ########## Scenario ##########  
# 
# {
#   feature: 'Feature: Account Consent Setup',
#   background: 'Background:\r\n' +
#     "        * def urlBase = karate.properties['url.base'] || karate.get('urlBase', 'http://localhost:4010')\r\n" +
#     '        * url urlBase\r\n' +
#     "        * def authToken = karate.properties['AUTH_TOKEN']",
#   rule: null,
#   scenario: {
#     title: 'Scenario Outline: Create account consent with valid data',
#     steps: "Given path '/aisp/account-consents'\r\n" +
#       "And header Authorization = 'Bearer ' + authToken\r\n" +
#       "And header Content-Type = 'application/json'\r\n" +
#       'And header x-fapi-auth-date = <x_fapi_auth_date>\r\n' +
#       'And header x-fapi-customer-ip-address = <x_fapi_customer_ip_address>\r\n' +
#       'And header x-fapi-interaction-id = <x_fapi_interaction_id>\r\n' +
#       'And header Accept-Language = <accept_language>\r\n' +
#       'And request <request_body>\r\n' +
#       'When method POST\r\n' +
#       'Then status 201\r\n' +
#       "And match responseHeaders['x-fapi-interaction-id'] == <x_fapi_interaction_id>\r\n" +
#       'And match response.data.consentId != null\r\n' +
#       'And match response.data.creationDate != null\r\n' +
#       "And match response.data.status == 'PendingAuthorise'\r\n" +
#       "And match response.data.permissions contains only ['ReadAccountAvailability', 'ReadAccountStatus', 'ReadAccountBalance', 'ReadAccountTransaction']\r\n" +
#       'And match response.data.expirationDate == <expiration_date>\r\n' +
#       'And match response.data.transactionFromDate == <transaction_from_date>\r\n' +
#       'And match response.data.transactionToDate == <transaction_to_date>\r',
#     examples: 'Examples:\r\n' +
#       '            | x_fapi_auth_date                | x_fapi_customer_ip_address | x_fapi_interaction_id | accept_language | request_body                                                                                                                                                                                | expiration_date        | transaction_from_date  | transaction_to_date    |\r\n' +
#       `            | 'Sun, 10 Sep 2017 19:43:31 UTC' | '169.254.169.254'          | 'uniq-id-123'         | 'en-HK'         | { "data": { "permissions": ["ReadAccountBalance"], "expirationDate": "2023-12-31T23:59:59Z", "transactionFromDate": "2023-01-01T00:00:00Z", "transactionToDate": "2023-12-31T23:59:59Z" } } | '2023-12-31T23:59:59Z' | '2023-01-01T00:00:00Z' | '2023-12-31T23:59:59Z' |`
#   }
# }
# 

# ********RoostGPT********
config:
  target: "{{ $processEnvironment.API_HOST }}/aisp"
  phases:
    - duration: 60
      arrivalRate: 1
  payload:
    path: "CreateAccountConsentWithValidData.csv"
    skipHeader: true
    fields:
      - "x_fapi_auth_date"
      - "x_fapi_customer_ip_address"
      - "x_fapi_interaction_id"
      - "accept_language"
      - "expiration_date"
      - "transaction_from_date"
      - "transaction_to_date"
    delimiter: "^|^"
  plugins:
    expect: {}

scenarios:
  - name: "Create account consent with valid data"
    flow:
      - post:
          url: "/account-consents"
          headers:
            Authorization: "Bearer {{ $processEnvironment.AUTH_TOKEN }}"
            Content-Type: "application/json"
            x-fapi-auth-date: "{{ x_fapi_auth_date }}"
            x-fapi-customer-ip-address: "{{ x_fapi_customer_ip_address }}"
            x-fapi-interaction-id: "{{ x_fapi_interaction_id }}"
            Accept-Language: "{{ accept_language }}"
          json:
            data:
              permissions: ["ReadAccountBalance"]
              expirationDate: "{{ expiration_date }}"
              transactionFromDate: "{{ transaction_from_date }}"
              transactionToDate: "{{ transaction_to_date }}"
          expect:
            - statusCode: 201
            - hasProperty: "consentId"
            - hasProperty: "creationDate"
            - hasProperty: "status"
            - hasProperty: "permissions"
            - hasProperty: "expirationDate"
            - hasProperty: "transactionFromDate"
            - hasProperty: "transactionToDate"
            - equals: 
                json: 
                  "$.data.status": "PendingAuthorise"
                headers:
                  "x-fapi-interaction-id": "{{ x_fapi_interaction_id }}"
          log: "Creating account consent with valid data should result in a 201 status code and response should match expected values."
      - think: 1
