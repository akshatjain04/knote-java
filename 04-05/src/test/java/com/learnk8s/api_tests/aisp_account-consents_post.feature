# ********RoostGPT********

# Test generated by RoostGPT for test MiniProjects using AI Type Open AI and AI Model gpt-4-1106-preview
# 
# Feature file generated for /aisp/account-consents_post for http method type POST 
# RoostTestHash=3a9edd08a1
# 
# 

# ********RoostGPT********
Feature: Account Consent Setup

  Background:
    * def urlBase = karate.properties['url.base'] || karate.get('urlBase', 'http://localhost:4010')
    * url urlBase
    * def authToken = karate.properties['AUTH_TOKEN']

  Scenario Outline: Create account consent with valid data
    Given path '/aisp/account-consents'
    And header Authorization = 'Bearer ' + authToken
    And header Content-Type = 'application/json'
    And header x-fapi-auth-date = <x_fapi_auth_date>
    And header x-fapi-customer-ip-address = <x_fapi_customer_ip_address>
    And header x-fapi-interaction-id = <x_fapi_interaction_id>
    And header Accept-Language = <accept_language>
    And request <request_body>
    When method POST
    Then status 201
    And match responseHeaders['x-fapi-interaction-id'] == <x_fapi_interaction_id>
    And match response.data.consentId != null
    And match response.data.creationDate != null
    And match response.data.status == 'PendingAuthorise'
    And match response.data.permissions contains only ['ReadAccountAvailability', 'ReadAccountStatus', 'ReadAccountBalance', 'ReadAccountTransaction']
    And match response.data.expirationDate == <expiration_date>
    And match response.data.transactionFromDate == <transaction_from_date>
    And match response.data.transactionToDate == <transaction_to_date>

    Examples:
      | read('aisp_account-consents_post.csv') |

  Scenario: Create account consent with missing required headers
    Given path '/aisp/account-consents'
    And header Authorization = 'Bearer ' + authToken
    And header Content-Type = 'application/json'
    And request
      """
      { "data": { "permissions": ["ReadAccountBalance"] } }
      """
    When method POST
    Then status 400
    And match response.errors[*].code contains 'OB.Header.Missing'

  Scenario: Unauthorized access to create account consent
    Given path '/aisp/account-consents'
    And header Authorization = 'Bearer invalid-token'
    And header Content-Type = 'application/json'
    And request
      """
      { "data": { "permissions": ["ReadAccountBalance"] } }
      """
    When method POST
    Then status 401

  Scenario: Create account consent with unsupported media type
    Given path '/aisp/account-consents'
    And header Authorization = 'Bearer ' + authToken
    And header Content-Type = 'text/plain'
    And request 'Invalid content type'
    When method POST
    Then status 415

  Scenario: Create account consent with method not allowed
    Given path '/aisp/account-consents'
    And header Authorization = 'Bearer ' + authToken
    And header Content-Type = 'application/json'
    And request
      """
      { "data": { "permissions": ["ReadAccountBalance"] } }
      """
    When method GET
    Then status 405

  Scenario: Create account consent with too many requests
    Given path '/aisp/account-consents'
    And header Authorization = 'Bearer ' + authToken
    And header Content-Type = 'application/json'
    And request
      """
      { "data": { "permissions": ["ReadAccountBalance"] } }
      """
    When method POST
    Then status 429
